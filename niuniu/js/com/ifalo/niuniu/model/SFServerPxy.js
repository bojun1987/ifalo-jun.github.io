var com,__extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(t){!function(t){!function(t){!function(e){var n=e.po.SFServerPO,o=SFS2X.SFSEvent,i=function(e){function i(){return e.call(this,i.PXY_NAME)||this}return __extends(i,e),i.prototype.onRegister=function(){e.prototype.onRegister.call(this),n.instance.init(),this.init()},i.prototype.onRemove=function(){e.prototype.onRemove.call(this)},i.prototype.init=function(){var t=n.instance.smartFox=new SFS2X.SmartFox(n.instance.CONFIG);t.addEventListener(o.CONNECTION,this.onConnect,this),t.addEventListener(o.CONNECTION_LOST,this.onConnect,this),t.addEventListener(o.LOGIN,this.onLogin,this),t.addEventListener(o.LOGIN_ERROR,this.onLoginError,this),t.addEventListener(o.LOGOUT,this.onLogout,this),t.addEventListener(o.ROOM_JOIN,this.onRoomJoin,this),t.addEventListener(o.USER_ENTER_ROOM,this.onUserEnterRoom,this),t.addEventListener(o.USER_EXIT_ROOM,this.onUserExitRoom,this),t.addEventListener(o.USER_VARIABLES_UPDATE,this.onUserVarsUpdate,this),t.addEventListener(o.MODERATOR_MESSAGE,this.onModeratorMessage,this),t.addEventListener(o.EXTENSION_RESPONSE,this.onExtensionResponse,this),t.connect()},i.prototype.dispose=function(){var t=n.instance.smartFox;t.removeEventListener(o.CONNECTION,this.onConnect),t.removeEventListener(o.CONNECTION_LOST,this.onConnectLost),t.removeEventListener(o.LOGIN,this.onLogin),t.removeEventListener(o.LOGIN_ERROR,this.onLoginError),t.removeEventListener(o.LOGOUT,this.onLogout),t.removeEventListener(o.ROOM_JOIN,this.onRoomJoin),t.removeEventListener(o.USER_ENTER_ROOM,this.onUserEnterRoom),t.removeEventListener(o.USER_EXIT_ROOM,this.onUserExitRoom),t.removeEventListener(o.USER_VARIABLES_UPDATE,this.onUserVarsUpdate),t.removeEventListener(o.MODERATOR_MESSAGE,this.onModeratorMessage),t.removeEventListener(o.EXTENSION_RESPONSE,this.onExtensionResponse),n.instance.init()},i.prototype.reset=function(){this.dispose(),this.init()},i.prototype.onConnect=function(t){var e=n.instance.smartFox;t.success?(this.log("連線成功 (SFS2X API 版本: "+e.version+"，連線: "+e.config.host+":"+e.config.port+" (zone: "+e.config.zone+")",1,t),n.instance.isConnectSucs=!0):(this.log("連線失敗，將嘗試重新連線 ",1,t),this.reset())},i.prototype.onConnectLost=function(t){this.log("連線異常，理由："+t.reason+"，將嘗試重新連線"),"kick"==t.reason?this.onModeratorMessage({type:"DUPLICATE_LOGIN"}):this.reset()},i.prototype.onLogin=function(t){n.instance.isLoginSucs=!0;var e=t.user;this.log("登入成功 (玩家 ID: "+e.id+"，玩家暱稱: "+n.instance.loginAccount+" ("+e.name+"))")},i.prototype.onLoginError=function(t){n.instance.isLoginSucs=!1,this.log("登入失敗 (錯誤代號: "+t.errorCode+"，錯誤訊息: "+t.errorMessage+")",1,t)},i.prototype.onLogout=function(t){n.instance.isLoginSucs=!1,this.log("登出完成")},i.prototype.onRoomJoin=function(t){var e=t.room;this.log("進入房間成功, name: "+e.name,1,t)},i.prototype.onUserEnterRoom=function(t){this.log("有新加入的成員 ",1,t)},i.prototype.onUserExitRoom=function(t){this.log("有已離開的成員 ",1,t)},i.prototype.onUserVarsUpdate=function(t){var e=t.user;this.log("user "+e,1,t)},i.prototype.onModeratorMessage=function(t){var e=t.type;this.log("type "+e,1,t)},i.prototype.onExtensionResponse=function(t){var e=t.cmd,n=t.params;this.log("SF Server 擴充功能: "+e+(n&&n.size()>0?"，內容: ":""),null,1,n&&n.size()>0?n.getDump(!0):null)},i.prototype.logout=function(){n.instance.smartFox.lastJoinedRoom&&n.sendRequest(new SFS2X.LeaveRoomRequest),n.sendRequest(new SFS2X.LogoutRequest)},i.prototype.login=function(e,o){if(n.instance.smartFox.isConnected){var i=t.GameEntry.params&&t.GameEntry.params.authType&&"OTP"==t.GameEntry.params.authType.toUpperCase();e=i?e:md5(e),o=i?o:md5(o);var s=new SFS2X.SFSObject;s.putUtfString("device","LayaWeb"),s.putUtfString("auth_type",i?"OTP":"WEB"),n.sendRequest(new SFS2X.LoginRequest(e,o,s,n.instance.smartFox.config.zone))}},i.PXY_NAME="SFServerPxy",i}(e.BasePxy);e.SFServerPxy=i}(t.model||(t.model={}))}(t.niuniu||(t.niuniu={}))}(t.ifalo||(t.ifalo={}))}(com||(com={}));